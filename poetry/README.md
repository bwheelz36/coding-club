# Coding Club - Poetry

21/02/2022 - Daniel Al Mouiee

## Introduction to Poetry

- [Poetry](https://python-poetry.org/)
- [Introduction](https://python-poetry.org/docs/)
- [Basic usage (Example)](https://python-poetry.org/docs/basic-usage/y)
- [List of commands](https://python-poetry.org/docs/cli/)

## Download Poetry
Download Poetry installation that is relevant to your machine from [here](https://python-poetry.org/docs/)

## Initialise Poetry project
We can create a Poetry project from scratch using

```bash
poetry new PROJECT_NAME
```

where PROJECT_NAME is the name of your project. This will create a default python project structure. This includes:
- Folder named PROJECT_NAME: this will hold the source code for your project
- Folder names tests: this will hold tests if your project uses a python testing suite (like `pytest`)
- `pyproject.toml`: a blueprint file that will hold project metadata and the dependencies that the project will use.

For existing codebases (like Pydicer), we can use ```poetry init``` to initialise the relevant files needed to package the project up. A new file is produced by the name `pyproject.toml`.

## Add dependencies (libraries)
We run the poetry add command to add the necessary dependencies. These are usually found in files named `requirements.txt`, `requirements-dev`, `reqs.txt`, etc... With Poetry, you'll need to pass these in one by one through the command line, (eg. poetry add pydicom>=2.1.2 platipy>=0.1.3 ...). Note: this is done once, when we need to update the dependencies, we run

```bash
poetry update DEPENDENCY_NAME
```

after the build command is ran and we'll have the ".lock", more about the lock file next.

## Install Dependencies
You can now install the dependencies with poetry using:

```bash
poetry install
```

rather than:
```bash
pip install -r ...
```

If you haven't run install before, then a `poetry.lock` file will be created which will hold the dependencies and their versionings that will be essentially locked to this project. If you already have a `.lock` file, then the installation will be done by reading it.

## Build a distribution from the project 
Now, we build the packaged version of the project using:
```bash
poetry build
```

Two files will be generated under a `dist` folder:
- `PROJECTNAME-PIN-py3-none-any.whl`
- `PROJECTNAME-PIN-.tar.gz`

Essentially, we can use one of these 2 files (preferably `.whl`) to install the project as a package using:
```bash
pip install ONE_OF_THOSE_FILES
```

and can be distributed with other users to install locally.

## Deployment/Publication to PyPI
While the 2 files generated by:

```bash
poetry build
```

can be used and distributed, it's much tider and better practice that we publish these builds onto a public forum like PyPi once the package is ready for distribution. To do this, we just need to config some options for publishing onto a platform like PyPi;
```bash
poetry publish --build --username USERNAME --password PASSWORD
```

where USERNAME or PASSWORD are your PyPI credentials.
Once the tool is on PyPi, we can install it with:

```bash
pip install PROJECT_NAME
```
